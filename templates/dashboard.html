{% extends "base.html" %}
{% block title %}Trang chủ{% endblock %}
{% block content %}
<h2 class="mb-4">Tổng quan quản lý phòng trọ</h2>

<!-- Các thẻ tổng quan -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary shadow">
            <div class="card-body">
                <h5>Tổng số phòng</h5>
                <h3>{{ total_rooms }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success shadow">
            <div class="card-body">
                <h5>Phòng đang cho thuê</h5>
                <h3>{{ occupied_rooms }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning shadow">
            <div class="card-body">
                <h5>Tiền phải thu tháng này</h5>
                <h3>{{ "{:,.0f}".format(total_due) }} đ</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white {% if overdue_bills > 0 %}bg-danger{% else %}bg-info{% endif %} shadow">
            <div class="card-body">
                <h5>Hóa đơn quá hạn</h5>
                <h3>{{ overdue_bills }}</h3>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5>Thu tiền tháng này</h5>
            </div>
            <div class="card-body">
                <p><strong>Đã thu:</strong> {{ "{:,.0f}".format(total_paid) }} đ</p>
                <p><strong>Chưa thu:</strong> {{ "{:,.0f}".format(total_unpaid) }} đ</p>
                <div class="progress">
                    {% set percent = (total_paid / total_due * 100) if total_due > 0 else 0 %}
                    <div class="progress-bar bg-success" style="width: {{ percent }}%">{{ "%.1f" % percent }}%</div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <a href="{{ url_for('create_room') }}" class="btn btn-success btn-lg w-100 h-100 d-flex align-items-center justify-content-center shadow">
            <i class="bi bi-plus-circle fs-1 me-3"></i>
            <div>
                <h4 class="mb-0">Thêm phòng mới</h4>
                <small>Bắt đầu cho thuê ngay</small>
            </div>
        </a>
    </div>
</div>

<h4 class="mt-5">Danh sách phòng trọ</h4>
<div class="row">
    {% for room in rooms %}
    <div class="col-md-4 mb-4">
        <div class="card shadow h-100">
            <div class="card-body">
                <h5 class="card-title">{{ room.name }}</h5>
                <p class="card-text">
                    <strong>Tiền thuê:</strong> {{ "{:,.0f}".format(room.rent_price) }} đ/tháng<br>
                    <strong>Internet:</strong> {{ "{:,.0f}".format(room.internet_fee) }} đ/tháng
                </p>
                {% if room.tenant %}
                    <span class="badge bg-success mb-2">Đang cho thuê</span><br>
                    <small>Khách: {{ room.tenant.name }}</small>
                {% else %}
                    <span class="badge bg-secondary">Trống</span>
                {% endif %}
                <a href="{{ url_for('room_detail', room_id=room.id) }}" class="btn btn-primary mt-3">
                    Xem chi tiết
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info text-center">
            Chưa có phòng trọ nào. <a href="{{ url_for('create_room') }}">Thêm phòng đầu tiên ngay!</a>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
